<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
	xmlns:activiti="http://activiti.org/bpmn" targetNamespace="http://www.bpmnwithactiviti.org/subprocess">
	
	<process id="delegationProcess" name="Delegation process example">
		<startEvent id="theStart" />
		<sequenceFlow sourceRef="theStart" targetRef="SeniorManager" />
		<scriptTask id="SeniorManager" scriptFormat="groovy">
			<script>
				out:println "Calling to manager with instruction " + problemDescription
				solution = "TBD"
			</script>
		</scriptTask>
		<sequenceFlow sourceRef="SeniorManager" targetRef="managerSubProcess" />
		<subProcess id="managerSubProcess">
			<startEvent id="theStartManagerSubProcess" />
			<sequenceFlow sourceRef="theStartManagerSubProcess" targetRef="Manager" />
			<scriptTask id="Manager" scriptFormat="groovy">
				<script>
					out:println "Manager received instruction " + problemDescription
					out:println "Shouting to developer with order " + problemDescription
				</script>
			</scriptTask>
			<sequenceFlow sourceRef="Manager" targetRef="developerSubProcess" />
			<subProcess id="developerSubProcess">
				<startEvent id="theStartDeveloperSubProcess" />
				<sequenceFlow sourceRef="theStartDeveloperSubProcess" targetRef="Developer" />
				<scriptTask id="Developer" scriptFormat="groovy">
					<script>
						out:println "Developer received order " + problemDescription
					</script>
				</scriptTask>
				<sequenceFlow sourceRef="Developer" targetRef="developerTask" />
				<userTask id="developerTask" activiti:assignee="developer"/>
				<sequenceFlow sourceRef="developerTask" targetRef="DeveloperReady" />
				<scriptTask id="DeveloperReady" scriptFormat="groovy">
					<script>
						solution = "I am ready, solution is 33"
						out:println "Developer is ready!!, solution is " + solution
					</script>
				</scriptTask>
				<sequenceFlow sourceRef="DeveloperReady" targetRef="theEndDeveloperSubProcess" />
				<endEvent id="theEndDeveloperSubProcess" />
			</subProcess>
			<boundaryEvent id="escalationTimerDeveloper" cancelActivity="true" attachedToRef="developerSubProcess">
				<timerEventDefinition>
			    	<timeDuration>PT2S</timeDuration>
			  	</timerEventDefinition>
			</boundaryEvent>
			<sequenceFlow sourceRef="escalationTimerDeveloper" targetRef="DeveloperEscalation" />
			<scriptTask id="DeveloperEscalation" scriptFormat="groovy">
				<script>
					out:println "Developer did not provide a solution to problem " + problemDescription
				</script>
			</scriptTask>
			<sequenceFlow sourceRef="DeveloperEscalation" targetRef="managerTask" />
			<userTask id="managerTask" activiti:assignee="manager"/>
			<sequenceFlow sourceRef="managerTask" targetRef="ManagerReady" />
			<scriptTask id="ManagerReady" scriptFormat="groovy">
				<script>
					solution = "It was a difficult problem, but it is solved within time"
					out:println "The manager is ready with the big problem"
				</script>
			</scriptTask>
			<sequenceFlow sourceRef="ManagerReady" targetRef="theEndSubProcess1" />
			<sequenceFlow sourceRef="developerSubProcess" targetRef="theEndSubProcess1" />
			<endEvent id="theEndSubProcess1" />
		</subProcess>
		<boundaryEvent id="escalationTimerManager" cancelActivity="true" attachedToRef="managerSubProcess">
			<timerEventDefinition>
		    	<timeDuration>PT4S</timeDuration>
		  	</timerEventDefinition>
		</boundaryEvent>
		<sequenceFlow sourceRef="escalationTimerManager" targetRef="ManagerEscalation" />
			<scriptTask id="ManagerEscalation" scriptFormat="groovy">
				<script>
					out:println "Manager did not provide a solution to problem " + problemDescription
				</script>
			</scriptTask>
		<sequenceFlow sourceRef="ManagerEscalation" targetRef="theEnd" />
		<sequenceFlow sourceRef="managerSubProcess" targetRef="theEnd" />
		<endEvent id="theEnd" />
	</process>
</definitions>